{% extends "base.html" %}
{% block title %}Cr√©er une question √† trous{% endblock %}
{% block content %}
<div class="container py-4">
    <h2>Cr√©er une question √† trous</h2>
    <div class="d-flex justify-content-end mb-3">
        <a href="{{ url_for('index') }}" class="btn btn-light border">
            üè† Retour vers l'accueil
        </a>
    </div>
    <form method="post" action="{{ url_for('create_question_trous') }}">
        <div class="mb-3">
            <label for="niveau_id" class="form-label">Niveau</label>
            <select class="form-select" id="niveau_id" name="niveau_id" required>
                {% for niveau in niveaux %}
                <option value="{{ niveau.id }}">{{ niveau.nom }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="chapitre_id" class="form-label">Chapitre</label>
            <select class="form-select" id="chapitre_id" name="chapitre_id" required>
                {% for chapitre in chapitres %}
                <option value="{{ chapitre.id }}">{{ chapitre.titre }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="probleme" class="form-label">√ânonc√© du probl√®me</label>
            <div class="input-group">
                <textarea class="form-control" id="probleme" name="probleme" rows="3" required></textarea>
                <button type="button" class="btn btn-secondary" id="btnTROU">&lt;TROU&gt;</button>
            </div>
            <div class="form-text">Utilisez le bouton <strong>&lt;TROU&gt;</strong> pour ins√©rer un trou √† l'emplacement du curseur.</div>
        </div>
        <div class="mb-3">
            <label class="form-label">Texte attendu et distracteurs pour chaque trou</label>
            <div id="resultsZones">
                <!-- Zones g√©n√©r√©es dynamiquement -->
            </div>
        </div>
        <div class="mb-3">
            <label for="difficulte" class="form-label">Difficult√©</label>
            <select class="form-select" id="difficulte" name="difficulte" required>
                <option value="facile">Facile</option>
                <option value="moyen">Moyen</option>
                <option value="difficile">Difficile</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Cr√©er</button>
    </form>
</div>
<script>
// Rafra√Æchissement dynamique des chapitres selon le niveau
const niveauSelect = document.getElementById('niveau_id');
const chapitreSelect = document.getElementById('chapitre_id');
niveauSelect.addEventListener('change', function() {
    fetch(`/admin/api/chapitres/${niveauSelect.options[niveauSelect.selectedIndex].text}`)
        .then(response => response.json())
        .then(data => {
            chapitreSelect.innerHTML = '';
            data.chapitres.forEach(chapitre => {
                const option = document.createElement('option');
                option.value = chapitre.id;
                option.textContent = chapitre.titre;
                chapitreSelect.appendChild(option);
            });
        });
});
// Insertion de la balise [TROU] √† la position du curseur
const btnTROU = document.getElementById('btnTROU');
const probleme = document.getElementById('probleme');
btnTROU.addEventListener('click', function() {
    const start = probleme.selectionStart;
    const end = probleme.selectionEnd;
    const value = probleme.value;
    probleme.value = value.substring(0, start) + '[TROU]' + value.substring(end);
    probleme.focus();
    probleme.selectionStart = probleme.selectionEnd = start + 6;
    updateResultsZones();
});
// G√©n√©ration dynamique des zones de texte pour chaque trou
function updateResultsZones() {
    const enonce = probleme.value;
    const nbTrous = (enonce.match(/\[TROU\]/g) || []).length;
    const resultsDiv = document.getElementById('resultsZones');
    resultsDiv.innerHTML = '';
    for (let i = 0; i < nbTrous; i++) {
        const label = document.createElement('label');
        label.textContent = 'R√©ponse correcte pour le trou ' + (i+1);
        label.className = 'form-label';
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'form-control mb-2';
        input.name = 'result_' + i;
        input.required = true;
        resultsDiv.appendChild(label);
        resultsDiv.appendChild(input);
        // Distracteurs
        const distractLabel = document.createElement('label');
        distractLabel.textContent = 'Distracteurs pour le trou ' + (i+1) + ' (s√©par√©s par des virgules)';
        distractLabel.className = 'form-label';
        const distractInput = document.createElement('input');
        distractInput.type = 'text';
        distractInput.className = 'form-control mb-2';
        distractInput.name = 'distracteurs_' + i;
        resultsDiv.appendChild(distractLabel);
        resultsDiv.appendChild(distractInput);
    }
}
probleme.addEventListener('input', updateResultsZones);
document.addEventListener('DOMContentLoaded', updateResultsZones);
</script>
{% endblock %}
